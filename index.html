<!DOCTYPE html>
    <head>
        <meta charset="utf-8">
        <title>Elektu!</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="prefetch" href="./img/fullscreen-checked.svg" />
        <link rel="prefetch" href="./img/fullscreen-unchecked.svg" />
        <link rel="prefetch" href="./img/group-checked.svg" />
        <link rel="prefetch" href="./img/group-unchecked.svg" />
        <link rel="prefetch" href="./img/help-checked.svg" />
        <link rel="prefetch" href="./img/help-unchecked.svg" />
        <link rel="prefetch" href="./img/ordinate-checked.svg" />
        <link rel="prefetch" href="./img/ordinate-unchecked.svg" />
        <link rel="prefetch" href="./img/select-checked.svg" />
        <link rel="prefetch" href="./img/select-unchecked.svg" />
        <link rel="prefetch" href="./img/vibration-checked.svg" />
        <link rel="prefetch" href="./img/vibration-unchecked.svg" />
        <script src="elektu.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/screenfull.js/3.3.3/screenfull.min.js"></script>
    </head>
    <body>
        <canvas id="canvas">shit.</canvas>
        <div id="menuContainer" class="transformBackIn">
            <div class="radio-group" id="radio-selectGroup">
                <input type="radio" id="option-select" name="selector" checked="checked" value="select"><label for="option-select"></label>
                <input type="radio" id="option-group" name="selector" value="teams"><label for="option-group"></label>
                <input type="radio" id="option-ordinate" name="selector" value="ordinate"><label for="option-ordinate"></label>
            </div>
            <div class="radio-group" id="radio-selectNumber">
                <input type="radio" id="number-1" name="number" checked="checked" value="1"><label for="number-1" id="label-number1">1</label>
                <input type="radio" id="number-2" name="number" value="2"><label for="number-2">2</label>
                <input type="radio" id="number-3" name="number" value="3"><label for="number-3">3</label>
                <input type="radio" id="number-4" name="number" value="4"><label for="number-4">4</label>
                <input type="radio" id="number-5" name="number" value="5"><label for="number-5">5</label>
            </div>
        </div>
        <div id="helpContainerWrapper">
            <div id="helpContainer">
                <dl>
                    <dt>
                        <img src="img/select-unchecked.svg">
                    </dt>
                    <dd>
                        <ol>
                            <li>Chose the number of people to be selected</li>
                            <li>Have everyone touch the screen</li>
                            <li>The selected people will be highlighted</li>
                        </ol>
                    </dd>
                    <dt>
                        <img src="img/group-unchecked.svg">
                    </dt>
                    <dd>
                        <ol>
                            <li>Chose a number of teams</li>
                            <li>Have everyone touch the screen</li>
                            <li>People will be split into teams</li>
                        </ol>
                    </dd>
                    <dt>
                        <img src="img/ordinate-unchecked.svg">
                    </dt>
                    <dd>
                        <ol>
                            <li>Have everyone touch the screen</li>
                            <li>People will be given a starting number</li>
                        </ol>
                    </dd>
                    <dt>
                        <img src="img/vibration-unchecked.svg">
                    </dt>
                    <dd>
                        Toggle the vibration
                    </dd>
                    <dt>
                        <img src="img/help-unchecked.svg">
                    </dt>
                    <dd>
                        Open this message
                    </dd>
                    <dt>
                        <img src="img/fullscreen-unchecked.svg">
                    </dt>
                    <dd>
                        Toggle fullscreen
                    </dd>
                </dl>
            </div>
        </div>
        <div id="footerContainer">
            <div id="footerGrid" class="transformBackIn">
                <input type='checkbox' id="toggle-vibration"/><label id="toggle-vibration-label" for="toggle-vibration"></label>
                <input type='checkbox' id="toggle-help"/><label for="toggle-help"></label>
                <input type='checkbox' id="toggle-fullscreen"/><label id="toggle-fullscreen-label" for="toggle-fullscreen"></label>
            </div>
        </div>
        <script>
const helpContainer = document.getElementById("helpContainerWrapper");
const labelNumber1 = document.getElementById("label-number1");
const radioSelectNumber = document.getElementById("radio-selectNumber");
const optionSelect = document.getElementById("option-select");
const toggleVibration = document.getElementById("toggle-vibration");
const toggleFullscreen = document.getElementById("toggle-fullscreen");

const showSelect = () => {
    labelNumber1.style.display = "";
    labelNumber1.style.visibility = "";
    radioSelectNumber.style.display = "";
    radioSelectNumber.style.visibility = "";
};

const showGroup = () => {
    labelNumber1.style.display = "none";
    labelNumber1.style.visibility = "hidden";
    radioSelectNumber.style.display = "";
    radioSelectNumber.style.visibility = "";
    if (document.getElementById("number-1").checked) {
        document.getElementById("number-2").checked = true;
        elektu.setSelectedNumber(2);
    }
};

const showOrdinate = () => {
    radioSelectNumber.style.display = "none";
    radioSelectNumber.style.visibility = "hidden";
};

// showing the help
document.getElementById("toggle-help").addEventListener("click", e => {
    document.getElementById("helpContainerWrapper").style.display = "block";
});

helpContainer.addEventListener("click", e => {
    document.getElementById("helpContainerWrapper").style.display = "none";
    document.getElementById("toggle-help").checked = false;
});

const menuContainer = document.getElementById("menuContainer");
const footerContainer = document.getElementById("footerContainer");
const canvas = document.getElementById("canvas");
let elektu;

const step = () => {
    elektu.update();
    elektu.draw();
    if (elektu.touchesLength() == 0) {
        showMenu();
    }
    else {
        hideMenu();
    }
    window.requestAnimationFrame(step);
};

const resizeCanvas = () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
};

const hideMenu = () => {
    menuContainer.classList.add("transformUp");
    menuContainer.classList.remove("transformBackIn");
    footerContainer.classList.add("transformDown");
    footerContainer.classList.remove("transformBackIn");
};
const showMenu = () => {
    menuContainer.classList.remove("transformUp");
    menuContainer.classList.add("transformBackIn");
    footerContainer.classList.remove("transformDown");
    footerContainer.classList.add("transformBackIn");
};
const updateFeature = () => {
    elektu.setFeature(document.querySelector('input[name="selector"]:checked').value);
}
const updateSelectedNumber = () => {
    elektu.setSelectedNumber(Number(document.querySelector(`input[name="number"]:checked`).value));
}
const updateVibration = () => {
    if(toggleVibration.checked) {
        window.navigator.vibrate(50);
    }
    elektu.setVibrate(toggleVibration.checked);
}
const requestFullscreenChange = () => {
    if(screenfull.enabled) {
        screenfull.toggle();
    }
}
const updateFullscreenIcon = () => {
    toggleFullscreen.checked = screenfull.isFullscreen;
}
const start = () => {
    elektu = new Elektu(canvas);
    // Properly initialise the radio buttons
    if (optionSelect.checked) {
        showSelect();
    }
    else if (document.getElementById("option-group").checked) {
        showGroup();
    }
    else { //option-ordinate
        showOrdinate();
    }
    // set the events on the radio buttons
    optionSelect.addEventListener("change", () => showSelect());
    document.getElementById("option-group").addEventListener("change", showGroup);
    document.getElementById("option-ordinate").addEventListener("change", showOrdinate);
    document.getElementById("radio-selectGroup").addEventListener("change", updateFeature);
    updateFeature();
    document.getElementById("radio-selectNumber").addEventListener("change", updateSelectedNumber);
    updateSelectedNumber();
    if (navigator.platform && /iPad|iPhone|iPod/.test(navigator.platform)) {
        // stupid Apple devices not allowing vibration API through...
        document.getElementById("toggle-vibration-label").style.opacity = 0;
    }
    else {
        toggleVibration.addEventListener("change", updateVibration);
        elektu.setVibrate(toggleVibration.checked);
    }

    if(screenfull.enabled) {
        toggleFullscreen.addEventListener("change", requestFullscreenChange);
        screenfull.on("change", updateFullscreenIcon);
    }
    else {
        // failed to load, hide the button
        document.getElementById("toggle-fullscreen-label").style.opacity = 0;
    }
    window.addEventListener('resize', resizeCanvas, false);

    resizeCanvas();
    window.requestAnimationFrame(step);
}
if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", start);
} else {
    start();
}
        </script>
    </body>
</html>


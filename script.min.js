const start=()=>{FastClick.attach(document.body);let timerTrigger=-1,resetAllTimeout=-1,vibrate=!1;const triggerTimeout=2500,displayTimeout=1500,defaultColours=["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"];let colour=[];const mainContainer=document.getElementById("mainContainer"),helpContainer=document.getElementById("helpContainerWrapper"),menuContainer=document.getElementById("menuContainer"),footerContainer=document.getElementById("footerContainer"),labelNumber1=document.getElementById("label-number1"),radioSelectNumber=document.getElementById("radio-selectNumber"),optionSelect=document.getElementById("option-select"),optionSelectIcon=document.getElementById("option-select-icon"),optionGroupIcon=document.getElementById("option-group-icon"),helpIcon=document.getElementById("toggle-help"),optionOrdinateIcon=document.getElementById("option-ordinate-icon"),touches=document.getElementsByClassName("touch"),showSelect=()=>{labelNumber1.style.display="",labelNumber1.style.visibility="",radioSelectNumber.style.display="",radioSelectNumber.style.visibility="",optionSelectIcon.classList.remove("md-inactive"),optionGroupIcon.classList.add("md-inactive"),optionOrdinateIcon.classList.add("md-inactive")},showGroup=()=>{labelNumber1.style.display="none",labelNumber1.style.visibility="hidden",radioSelectNumber.style.display="",radioSelectNumber.style.visibility="",document.getElementById("number-1").checked&&(document.getElementById("number-2").checked=!0),optionSelectIcon.classList.add("md-inactive"),optionGroupIcon.classList.remove("md-inactive"),optionOrdinateIcon.classList.add("md-inactive")},showOrdinate=()=>{radioSelectNumber.style.display="none",radioSelectNumber.style.visibility="hidden",optionSelectIcon.classList.add("md-inactive"),optionGroupIcon.classList.add("md-inactive"),optionOrdinateIcon.classList.remove("md-inactive")};optionSelect.checked?showSelect():document.getElementById("option-group").checked?showGroup():showOrdinate(),screenfull.isFullScreen&&document.getElementById("toggle-vibration").classList.remove("md-inactive"),optionSelect.addEventListener("change",()=>showSelect()),document.getElementById("option-group").addEventListener("change",()=>showGroup()),document.getElementById("option-ordinate").addEventListener("change",()=>showOrdinate()),document.getElementById("toggle-vibration").addEventListener("click",e=>{e.target.classList.toggle("md-inactive"),(vibrate=!vibrate)&&window.navigator.vibrate(50)}),document.getElementById("toggle-fullscreen").addEventListener("click",e=>{e.target.classList.toggle("md-inactive"),screenfull.toggle()}),helpIcon.addEventListener("click",e=>{helpContainer.style.display="block",helpIcon.classList.remove("md-inactive")}),helpContainer.addEventListener("click",e=>{hideHelp()});const hideHelp=()=>{helpContainer.style.display="none",helpIcon.classList.add("md-inactive")};screenfull.on("change",()=>{document.getElementById("toggle-fullscreen").classList.toggle("md-inactive")});const getRandomColour=()=>colour.splice(Math.floor(Math.random()*colour.length),1)[0],getNoTeamColour=()=>"#C0C0C0",getRadioValue=id=>Number(document.querySelector(`input[name="${id}"]:checked`).value),shuffleArray=array=>{let currentIndex=array.length;for(;0!==currentIndex;){let randomIndex=Math.floor(Math.random()*currentIndex--),temporaryValue=array[currentIndex];array[currentIndex]=array[randomIndex],array[randomIndex]=temporaryValue}return array},selectPlayers=numberToSelect=>{const playerList=[...touches].map(t=>t.id),shuffledList=shuffleArray(playerList);let i;for(i=0;i<shuffledList.length;++i){const element=document.getElementById(shuffledList[i]);if(element)if(i<numberToSelect){const spinner=element.getElementsByTagName("div")[0];spinner.style.borderColor=spinner.style.borderTopColor}else element.parentNode.removeChild(element)}},selectTeams=numberOfTeams=>{const splitIntoTeams=(randomisedTouches,numberOfTeams)=>{const touchCount=randomisedTouches.length,teamArray=[];let i=0;if(touchCount%numberOfTeams==0){const size=Math.floor(touchCount/numberOfTeams);for(;i<touchCount;)teamArray.push(randomisedTouches.slice(i,i+=size))}else for(;i<touchCount;){const size=Math.ceil((touchCount-i)/numberOfTeams--);teamArray.push(randomisedTouches.slice(i,i+=size))}return teamArray},playerList=[...touches].map(t=>t.id);if(numberOfTeams>playerList.length)throw new RangeError("selectTeams: more elements taken than available");const splitTeams=splitIntoTeams(shuffleArray(playerList),numberOfTeams);for(let i=0;i<splitTeams.length;++i){const teamColour=getRandomColour();for(let j=0;j<splitTeams[i].length;++j){const e=document.getElementById(splitTeams[i][j]);if(e){e.style.background=teamColour;const spinner=e.getElementsByTagName("div")[0];spinner.style.borderColor=teamColour}}}},selectNumbers=()=>{const playerList=[...touches].map(t=>t.id),randomisedTouches=shuffleArray(playerList);for(let i=0;i<randomisedTouches.length;++i){const e=document.getElementById(randomisedTouches[i]);if(e){const spinner=e.getElementsByTagName("div")[0];spinner.style.borderColor=spinner.style.borderTopColor;const s=e.getElementsByTagName("span")[0];s&&(s.textContent=i+1)}}},resetAll=()=>{colour=defaultColours.slice(),showMenu(),[...touches].forEach(t=>{t.parentNode.removeChild(t)}),clearTimeout(timerTrigger),clearTimeout(resetAllTimeout),mainContainer.removeEventListener("touchstart",ignoreEvent),mainContainer.removeEventListener("touchmove",ignoreEvent),mainContainer.removeEventListener("touchend",ignoreEvent),mainContainer.removeEventListener("touchend",handleFinishTouchEnd),mainContainer.addEventListener("touchstart",handleNewTouch),mainContainer.addEventListener("touchmove",handleTouchMove),mainContainer.addEventListener("touchend",handleTouchEnd)},triggerSelection=()=>{clearTimeout(timerTrigger);const numbersSelected=getRadioValue("number");switch(getFeatureType()){case featureTypes.select:selectPlayers(numbersSelected);break;case featureTypes.teams:selectTeams(numbersSelected);break;case featureTypes.ordinate:selectNumbers();break;default:throw new Error("Unrecognised feature type.")}vibrate&&window.navigator.vibrate([50,10,50]),mainContainer.removeEventListener("touchstart",handleNewTouch),mainContainer.addEventListener("touchstart",ignoreEvent),mainContainer.removeEventListener("touchend",handleTouchEnd),mainContainer.addEventListener("touchend",handleFinishTouchEnd)},hideMenu=()=>{menuContainer.classList.add("transformUp"),menuContainer.classList.remove("transformBackIn"),footerContainer.classList.add("transformDown"),footerContainer.classList.remove("transformBackIn")},showMenu=()=>{menuContainer.classList.remove("transformUp"),menuContainer.classList.add("transformBackIn"),footerContainer.classList.remove("transformDown"),footerContainer.classList.add("transformBackIn")},handleNewTouch=ev=>{hideMenu();const changedTouches=ev.changedTouches;for(let i=0;i<changedTouches.length;++i){const newTouch=document.createElement("div"),span=document.createElement("span"),spinner=document.createElement("div");spinner.classList.add("spinner"),newTouch.classList.add("touch"),newTouch.id=`touch-${changedTouches[i].identifier}`;const touchColour=getFeatureType()==featureTypes.teams?"#C0C0C0":getRandomColour();spinner.style.borderTopColor=touchColour,newTouch.style.background=touchColour,newTouch.style.color=touchColour,newTouch.style.top=`${changedTouches[i].pageY}px`,newTouch.style.left=`${changedTouches[i].pageX}px`,newTouch.appendChild(spinner),newTouch.appendChild(span),mainContainer.appendChild(newTouch)}resetTimerTrigger()},resetTimerTrigger=()=>{const feature=getFeatureType();clearTimeout(timerTrigger),(feature==featureTypes.select&&touches.length>getRadioValue("number")||feature==featureTypes.teams&&touches.length>=getRadioValue("number")||feature==featureTypes.ordinate)&&(timerTrigger=setTimeout(triggerSelection,2500))},featureTypes=Object.freeze({select:1,teams:2,ordinate:3}),getFeatureType=()=>{switch(document.querySelector('input[name="selector"]:checked').value){case"select":return featureTypes.select;case"teams":return featureTypes.teams;case"ordinate":return featureTypes.ordinate;default:throw new Error("Unrecognised feature type.")}},handleTouchMove=ev=>{eventHandler(ev)},ignoreEvent=ev=>{ev.preventDefault()},handleTouchEnd=ev=>{eventHandler(ev)},handleFinishTouchEnd=ev=>{eventHandler(ev,!0)},eventHandler=(ev,finish=!1)=>{ev.preventDefault();const changedTouches=ev.changedTouches;for(let i=0;i<changedTouches.length;++i){const element=document.getElementById(`touch-${changedTouches[i].identifier}`);if(element)switch(ev.type){case"touchmove":element.classList.contains("locked")||(element.style.top=`${changedTouches[i].pageY}px`,element.style.left=`${changedTouches[i].pageX}px`);break;case"touchend":finish?(element.classList.add("locked"),0==document.querySelectorAll(".touch:not(.locked)").length&&(resetAllTimeout=setTimeout(resetAll,1500))):(getFeatureType()!=featureTypes.teams&&colour.push(element.style.backgroundColor),element.parentNode.removeChild(element),resetTimerTrigger());break;default:throw new Error("Unrecognised event type.")}}"touchend"==ev.type&&0==touches.length&&showMenu()};resetAll()};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",start):start();